<!DOCTYPE html>
<html>
<head>
    <title>Agenda - {{ usuario.get_full_name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .evento { margin-bottom: 15px; padding: 10px; border-left: 4px solid #007bff; }
        .clase { border-left-color: #ffc107; background-color: #fffbf0; }
        .disponible { border-left-color: #28a745; background-color: #f0fff4; }
        .ocupado { border-left-color: #dc3545; background-color: #fff0f0; }
        .fecha { font-weight: bold; margin-bottom: 10px; }
        @media print {
            .no-print { display: none; }
            body { margin: 0; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Mi Agenda - EduLink</h1>
        <p><strong>Usuario:</strong> {{ usuario.get_full_name }}</p>
        <p><strong>Fecha de impresión:</strong> {{ fecha_impresion }}</p>
    </div>

    <div class="no-print" style="margin-bottom: 20px;">
        <button onclick="window.print()" class="btn btn-primary">Imprimir</button>
        <button onclick="window.close()" class="btn btn-secondary">Cerrar</button>
    </div>

    <h2>Eventos y Clases</h2>
    
    {% for evento in eventos %}
    <div class="evento {% if evento.tipo == 'disponible' %}disponible{% elif evento.tipo == 'ocupacion' %}ocupado{% endif %}">
        <div class="fecha">
            {{ evento.fecha_inicio|date:"d/m/Y H:i" }} - {{ evento.fecha_fin|date:"d/m/Y H:i" }}
        </div>
        <strong>{{ evento.titulo }}</strong> ({{ evento.get_tipo_display }})
        {% if evento.descripcion %}<p>{{ evento.descripcion }}</p>{% endif %}
    </div>
    {% endfor %}

    {% for clase in clases %}
    <div class="evento clase">
        <div class="fecha">
            {% if clase.fecha_clase_confirmada %}
                {{ clase.fecha_clase_confirmada|date:"d/m/Y H:i" }}
            {% else %}
                {{ clase.fecha_clase_propuesta|date:"d/m/Y H:i" }}
            {% endif %}
        </div>
        <strong>Clase: {{ clase.materia.nombre }}</strong>
        <p>
            {% if usuario.rol == 'ALUMNO' %}
                Profesor: {{ clase.maestro.usuario.get_full_name }}
            {% else %}
                Alumno: {{ clase.alumno.usuario.get_full_name }}
            {% endif %}
            <br>Duración: {{ clase.duracion_minutos }} minutos
            {% if clase.monto_acordado %}<br>Monto: ${{ clase.monto_acordado }}{% endif %}
        </p>
    </div>
    {% endfor %}

    {% if not eventos and not clases %}
    <p>No hay eventos ni clases programadas.</p>
    {% endif %}

    <script>
        // Imprimir automáticamente al cargar
        window.onload = function() {
            window.print();
        };
    </script>
</body>
</html>