{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fas fa-qrcode me-2"></i>Pago de Clase</h4>
                </div>
                <div class="card-body">
                    <!-- Información de la clase -->
                    <div class="alert alert-info">
                        <h5>Detalles de la clase:</h5>
                        <p><strong>Maestro:</strong> {{ solicitud.maestro.usuario.get_full_name }}</p>
                        <p><strong>Materia:</strong> {{ solicitud.materia.nombre }}</p>
                        <p><strong>Fecha:</strong> {{ solicitud.fecha_clase_confirmada|date:"d/m/Y H:i" }}</p>
                        <p><strong>Duración:</strong> {{ solicitud.duracion_minutos }} minutos</p>
                        <p><strong>Monto:</strong> ${{ solicitud.monto_acordado|default:"0.00" }}</p>
                        <p><strong>Método de pago:</strong> {{ solicitud.get_metodo_pago_display }}</p>
                    </div>

                    {% if datos_pago.tipo == 'mercadopago' %}
                    <div class="text-center">
                        <h5>Pago con Mercado Pago</h5>
                        {% if qr_image %}
                        <div class="mb-3">
                            <img src="data:image/png;base64,{{ qr_image }}" alt="QR Code" class="img-fluid" style="max-width: 300px;">
                        </div>
                        <p>Escanea el código QR con la app de Mercado Pago</p>
                        {% endif %}
                        <div class="alert alert-warning">
                            <small>
                                <strong>Instrucciones:</strong><br>
                                1. Abre la app de Mercado Pago<br>
                                2. Toca "Pagar"<br>
                                3. Escanea el código QR<br>
                                4. Confirma el pago de ${{ datos_pago.monto }}
                            </small>
                        </div>
                    </div>

                    {% elif datos_pago.tipo == 'transferencia' %}
                    <div class="text-center">
                        <h5>Transferencia Bancaria</h5>
                        {% if qr_image %}
                        <div class="mb-3">
                            <img src="data:image/png;base64,{{ qr_image }}" alt="QR Code" class="img-fluid" style="max-width: 300px;">
                        </div>
                        <p>Escanea el código QR para transferir</p>
                        {% endif %}
                        <div class="alert alert-info">
                            <h6>Datos para transferencia:</h6>
                            <p><strong>Beneficiario:</strong> {{ datos_pago.beneficiario }}</p>
                            <p><strong>CBU/CVU:</strong> {{ datos_pago.cbu_cvu }}</p>
                            <p><strong>Monto:</strong> ${{ datos_pago.monto }}</p>
                            <p><strong>Concepto:</strong> {{ datos_pago.concepto }}</p>
                        </div>
                    </div>

                    {% else %}
                    <div class="text-center">
                        <h5>Pago en Efectivo</h5>
                        <div class="alert alert-success">
                            <p>{{ datos_pago.instrucciones }}</p>
                            <p><strong>Monto a pagar: ${{ datos_pago.monto }}</strong></p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="d-grid gap-2 mt-4">
                        <a href="{% url 'mis_solicitudes_alumno' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Volver a Mis Solicitudes
                        </a>
                    </div>
                </div>
            </div>
            {% if not qr_image and not enlace_pago %}
            <div class="alert alert-warning mt-3">
                No fue posible generar el código QR. Verifica que el maestro tenga un CBU/Alias configurado o que el
                método de pago sea válido.
            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}