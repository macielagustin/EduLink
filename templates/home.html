{% extends "base.html" %}
{% load static %}
{% block title %}EduLink ¬∑ Tu plataforma de clases particulares{% endblock %}

{% block body_class %}bg-home{% endblock %}

{% block content %}

<!-- HERO MEJORADO -->
<section class="hero-section text-white py-5 mb-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-4 fw-bold mb-4">Aprend√© con los mejores <span class="text-warning">profesores</span></h1>
        <p class="lead mb-4">Encontr√° tu profesor ideal entre {{ total_profesores }}+ profesionales. Clases online y presenciales adaptadas a vos.</p>
        
        <div class="hero-stats row mb-4">
          <div class="col-4">
            <div class="text-center">
              <h3 class="fw-bold mb-1">{{ total_profesores }}+</h3>
              <small>Profesores</small>
            </div>
          </div>
          <div class="col-4">
            <div class="text-center">
              <h3 class="fw-bold mb-1">{{ total_materias }}+</h3>
              <small>Materias</small>
            </div>
          </div>
          <div class="col-4">
            <div class="text-center">
              <h3 class="fw-bold mb-1">{{ total_clases }}+</h3>
              <small>Clases</small>
            </div>
          </div>
        </div>

        <!-- Buscador Mejorado -->
        <div class="search-card bg-white rounded-3 p-4 shadow-lg">
          <form method="get" action="{% url 'buscar_clases' %}" class="row g-2">
            <div class="col-md-5">
              <label class="form-label text-dark mb-1 fw-semibold">¬øQu√© quer√©s aprender?</label>
              <select name="materia" class="form-select">
                <option value="">Todas las materias</option>
                {% for materia_data in materias_populares %}
                <option value="{{ materia_data.materia.id }}">{{ materia_data.materia.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label text-dark mb-1 fw-semibold">Modalidad</label>
              <select name="modalidad" class="form-select">
                <option value="">Todas</option>
                <option value="Online">Online</option>
                <option value="Presencial">Presencial</option>
                <option value="Ambos">Ambas</option>
              </select>
            </div>
            <div class="col-md-4 d-grid">
              <label class="form-label text-dark mb-1 invisible">Buscar</label>
              <button class="btn btn-primary btn-lg">
                <i class="fas fa-search me-2"></i>Buscar Profesores
              </button>
            </div>
          </form>
        </div>
      </div>
      
      <div class="col-lg-6 text-center">
        <div class="hero-illustration">
          <div class="position-relative">
            <div class="floating-element element-1">
              <i class="fas fa-book-open fa-3x text-warning"></i>
            </div>
            <div class="floating-element element-2">
              <i class="fas fa-laptop-code fa-3x text-info"></i>
            </div>
            <div class="floating-element element-3">
              <i class="fas fa-chart-line fa-3x text-success"></i>
            </div>
            <div class="main-illustration">
              <i class="fas fa-graduation-cap fa-8x text-white opacity-75"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="container">
  
  <!-- ANUNCIOS DESTACADOS -->
  <section class="announcements mb-5">
    <div class="row g-3">
      {% for anuncio in anuncios %}
      <div class="col-lg-3 col-md-6">
        <div class="announcement-card bg-{{ anuncio.color }} text-white rounded-3 p-4 h-100">
          <div class="d-flex align-items-start">
            <i class="fas {{ anuncio.icon }} fa-2x me-3 mt-1"></i>
            <div>
              <h6 class="fw-bold mb-2">{{ anuncio.titulo }}</h6>
              <p class="small mb-0 opacity-90">{{ anuncio.descripcion }}</p>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- CONTENIDO PRINCIPAL CON FONDO BLANCO -->
  <div class="bg-white rounded-3 p-4 shadow-sm mb-4">
    
    <!-- PROFESOR DESTACADO (MEJOR CALIFICADO) -->
    {% if profesor_destacado %}
    <section class="featured-teacher mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h3 class="fw-bold mb-1">üåü Profesor Destacado del Mes</h3>
          <p class="text-muted mb-0">Nuestro profesor mejor calificado por los estudiantes</p>
        </div>
        <a href="{% url 'buscar_clases' %}" class="btn btn-outline-primary">Ver todos los profesores</a>
      </div>
      
      <div class="card border-0 shadow-lg featured-card">
        <div class="row g-0">
          <div class="col-md-3">
            {% if profesor_destacado.usuario.foto_perfil %}
              <img src="{{ profesor_destacado.usuario.foto_perfil.url }}" class="img-fluid rounded-start h-100 object-fit-cover" alt="{{ profesor_destacado.usuario.get_full_name }}" style="height: 280px; object-fit: cover;">
            {% else %}
              <div class="bg-gradient-primary d-flex align-items-center justify-content-center h-100 rounded-start">
                <i class="fas fa-user-graduate fa-5x text-white"></i>
              </div>
            {% endif %}
          </div>
          <div class="col-md-9">
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <span class="badge bg-warning text-dark mb-2">
                    ‚≠ê {{ profesor_destacado.avg_rating|default:"5.0"|floatformat:1 }}/5.0
                    ({{ profesor_destacado.review_count|default:"0" }} rese√±a{{ profesor_destacado.review_count|default:"1"|pluralize }})
                  </span>
                  <h3 class="card-title fw-bold text-primary">{{ profesor_destacado.usuario.get_full_name|default:profesor_destacado.usuario.username }}</h3>
                  <p class="text-muted mb-3">
                    {% with profesor_destacado.materias.all|first as primera_materia %}
                      {% if primera_materia %}
                        Especialista en <strong>{{ primera_materia.nombre }}</strong>
                      {% else %}
                        Profesor particular certificado
                      {% endif %}
                    {% endwith %}
                  </p>
                </div>
                <div class="text-end">
                  <div class="h3 text-success fw-bold">${{ profesor_destacado.precio_hora }}<span class="h6 text-muted">/hora</span></div>
                  <small class="text-success">
                    {{ profesor_destacado.total_clases|default:"0" }} clase{{ profesor_destacado.total_clases|default:"1"|pluralize }} impartida{{ profesor_destacado.total_clases|default:"1"|pluralize }}
                  </small>
                </div>
              </div>
              
              <p class="card-text mb-4 fs-5">
                {% if profesor_destacado.descripcion %}
                  {{ profesor_destacado.descripcion|truncatewords:40 }}
                {% else %}
                  Profesor con amplia experiencia y excelentes rese√±as de sus estudiantes. Comprometido con el √©xito acad√©mico de cada alumno.
                {% endif %}
              </p>
              
              <div class="d-flex flex-wrap gap-2 mb-4">
                {% for materia in profesor_destacado.materias.all|slice:":5" %}
                  <span class="badge bg-light text-dark border fs-6">üìö {{ materia.nombre }}</span>
                {% endfor %}
                {% if profesor_destacado.materias.count > 5 %}
                  <span class="badge bg-light text-dark border">+{{ profesor_destacado.materias.count|add:"-5" }} m√°s</span>
                {% endif %}
                <span class="badge bg-primary text-white fs-6">üìç {{ profesor_destacado.modalidad }}</span>
              </div>
              
              <div class="d-flex gap-3">
                <a href="{% url 'enviar_solicitud_clase' profesor_destacado.id %}" class="btn btn-primary btn-lg px-4">
                  <i class="fas fa-calendar-plus me-2"></i>Solicitar clase
                </a>
                <a href="{% url 'perfil_maestro_publico' profesor_destacado.id %}" class="btn btn-outline-primary btn-lg px-4">
                  <i class="fas fa-eye me-2"></i>Ver perfil completo
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    {% endif %}

    <!-- NUEVOS PROFESORES - CORREGIDO -->
    <section class="new-teachers mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h3 class="fw-bold mb-1">üöÄ Nuevos en la Plataforma</h3>
          <p class="text-muted mb-0">Descubr√≠ a nuestros profesores m√°s recientes</p>
        </div>
        <a href="{% url 'buscar_clases' %}" class="btn btn-outline-primary">Ver todos</a>
      </div>
      
      <div class="row g-4">
        {% for maestro in nuevos_profesores %}
        <div class="col-xl-3 col-lg-4 col-md-6">
          <div class="card h-100 border-0 shadow-sm teacher-card">
            <div class="position-relative">
              {% if maestro.usuario.foto_perfil %}
                <img src="{{ maestro.usuario.foto_perfil.url }}" class="card-img-top" alt="{{ maestro.usuario.get_full_name }}" style="height: 200px; object-fit: cover;">
              {% else %}
                <div class="bg-gradient-light d-flex align-items-center justify-content-center" style="height: 200px;">
                  <i class="fas fa-user-graduate fa-4x text-muted"></i>
                </div>
              {% endif %}
              <span class="position-absolute top-0 start-0 bg-success text-white px-3 py-1 small fw-bold rounded-end">Nuevo</span>
              {% if maestro.usuario.verificado %}
              <span class="position-absolute top-0 end-0 bg-primary text-white px-2 py-1 small rounded-start">
                <i class="fas fa-check-circle me-1"></i>Verificado
              </span>
              {% endif %}
            </div>
            <div class="card-body">
              <h6 class="card-title fw-bold text-dark mb-2">{{ maestro.usuario.get_full_name|default:maestro.usuario.username }}</h6>
              <p class="card-text small text-muted mb-3">
                {% with maestro.materias.all|first as primera_materia %}
                  {% if primera_materia %}
                    {{ primera_materia.nombre }}
                  {% else %}
                    Profesor multidisciplinario
                  {% endif %}
                {% endwith %}
              </p>
              <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="h5 text-primary fw-bold mb-0">${{ maestro.precio_hora }}/h</span>
                <span class="badge bg-light text-dark border">{{ maestro.modalidad }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  {% if maestro.avg_rating %}
                  <small class="text-warning fw-bold">
                    ‚≠ê {{ maestro.avg_rating|floatformat:1 }} <span class="text-muted">({{ maestro.review_count }})</span>
                  </small>
                  {% else %}
                  <small class="text-muted">Sin calificaciones a√∫n</small>
                  {% endif %}
                </div>
                <small class="text-muted">
                  {% widthratio maestro.review_count|default:1 1 10 %}% recomendado
                </small>
              </div>
            </div>
            <div class="card-footer bg-transparent border-0 pt-0">
              <a href="{% url 'perfil_maestro_publico' maestro.id %}" class="btn btn-outline-primary w-100">Ver perfil</a>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="text-center py-5">
            <i class="fas fa-users fa-4x text-muted mb-3"></i>
            <h5 class="text-muted">A√∫n no hay nuevos profesores</h5>
            <p class="text-muted mb-4">S√© el primero en unirte a nuestra plataforma</p>
            {% if not user.is_authenticated %}
            <a href="{% url 'registro_maestro' %}" class="btn btn-primary btn-lg">¬°Registrarme como Profesor!</a>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- MATERIAS POPULARES -->
    <section class="popular-subjects mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h3 class="fw-bold mb-1">üìö Materias M√°s Populares</h3>
          <p class="text-muted mb-0">Encontr√° profesores para las materias m√°s demandadas</p>
        </div>
        <a href="{% url 'buscar_clases' %}" class="btn btn-outline-primary">Explorar todas</a>
      </div>
      <div class="row g-3">
        {% for materia_data in materias_populares %}
        <div class="col-xl-2 col-md-4 col-sm-6">
          <a href="{% url 'buscar_clases' %}?materia={{ materia_data.materia.id }}" class="subject-card card text-center border-0 shadow-sm h-100 text-decoration-none">
            <div class="card-body py-4">
              <div class="subject-icon bg-primary bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3">
                <i class="fas fa-book fa-2x text-primary"></i>
              </div>
              <h6 class="card-title fw-bold text-dark mb-2">{{ materia_data.materia.nombre }}</h6>
              <small class="text-muted">{{ materia_data.num_profesores }} profesor{{ materia_data.num_profesores|pluralize:"es" }}</small>
            </div>
          </a>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="text-center py-4">
            <i class="fas fa-book fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">Pr√≥ximamente m√°s materias</h5>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- PUBLICIDAD PARA PROFESORES -->
    <section class="teacher-promo mb-5">
      <div class="card bg-gradient-primary text-white border-0 overflow-hidden">
        <div class="card-body p-5">
          <div class="row align-items-center">
            <div class="col-lg-8">
              <h3 class="fw-bold mb-3">¬øSos Profesor? ¬°Unite a EduLink!</h3>
              <p class="mb-4 fs-5">Lleg√° a miles de estudiantes y gener√° ingresos haciendo lo que am√°s. Plataforma segura y pagos garantizados.</p>
              <div class="row mb-4">
                <div class="col-md-4">
                  <div class="text-center">
                    <h4 class="fw-bold mb-1">+{{ total_profesores }}</h4>
                    <small>Profesores activos</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center">
                    <h4 class="fw-bold mb-1">+{{ total_clases }}</h4>
                    <small>Clases impartidas</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center">
                    <h4 class="fw-bold mb-1">100%</h4>
                    <small>Pagos seguros</small>
                  </div>
                </div>
              </div>
              {% if not user.is_authenticated %}
              <a href="{% url 'registro_maestro' %}" class="btn btn-light btn-lg me-3">
                <i class="fas fa-user-plus me-2"></i>Registrarme como Profesor
              </a>
              {% else %}
              <a href="{% url 'dashboard_maestro' %}" class="btn btn-light btn-lg me-3">
                <i class="fas fa-tachometer-alt me-2"></i>Ir a mi Panel
              </a>
              {% endif %}
              <a href="#" class="btn btn-outline-light btn-lg">Saber m√°s</a>
            </div>
            <div class="col-lg-4 text-center">
              <i class="fas fa-chalkboard-teacher fa-8x opacity-50"></i>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div> <!-- Fin del contenedor blanco -->

</div>

<!-- CTA FINAL -->
<section class="bg-dark text-white py-5 mt-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h3 class="fw-bold mb-2">¬øListo para empezar a aprender?</h3>
        <p class="mb-0 fs-5">Unite a {{ total_profesores }}+ profesores y {{ total_clases }}+ clases impartidas con √©xito</p>
      </div>
      <div class="col-lg-4 text-lg-end">
        {% if not user.is_authenticated %}
        <a class="btn btn-primary btn-lg me-2 px-4" href="{% url 'registro_persona' %}">
          <i class="fas fa-user-plus me-2"></i>Crear cuenta gratis
        </a>
        <a class="btn btn-outline-light btn-lg px-4" href="{% url 'login' %}">
          <i class="fas fa-sign-in-alt me-2"></i>Ingresar
        </a>
        {% else %}
        <a class="btn btn-primary btn-lg me-2 px-4" href="{% url 'buscar_clases' %}">
          <i class="fas fa-search me-2"></i>Buscar Clases
        </a>
        {% if user.rol == 'MAESTRO' %}
        <a class="btn btn-outline-light btn-lg px-4" href="{% url 'dashboard_maestro' %}">
          <i class="fas fa-tachometer-alt me-2"></i>Mi Panel
        </a>
        {% else %}
        <a class="btn btn-outline-light btn-lg px-4" href="{% url 'dashboard_alumno' %}">
          <i class="fas fa-tachometer-alt me-2"></i>Mi Panel
        </a>
        {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_css %}
<style>
.hero-section {
  background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
  border-radius: 0 0 2rem 2rem;
  position: relative;
  overflow: hidden;
}

.hero-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="%23ffffff" fill-opacity="0.05" points="0,1000 1000,0 1000,1000"/></svg>');
  background-size: cover;
}

.search-card {
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95) !important;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.hero-illustration {
  position: relative;
  height: 300px;
}

.floating-element {
  position: absolute;
  animation: float 3s ease-in-out infinite;
}

.element-1 {
  top: 20px;
  left: 50px;
  animation-delay: 0s;
}

.element-2 {
  top: 100px;
  right: 80px;
  animation-delay: 1s;
}

.element-3 {
  bottom: 50px;
  left: 100px;
  animation-delay: 2s;
}

.main-illustration {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.announcement-card, .promo-card {
  transition: all 0.3s ease;
  border: none;
}

.announcement-card:hover, .promo-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
}

.subject-card, .teacher-card {
  transition: all 0.3s ease;
}

.subject-card:hover, .teacher-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;
}

.featured-card {
  border: 3px solid transparent;
  background: linear-gradient(white, white) padding-box,
              linear-gradient(135deg, #0d6efd, #0dcaf0) border-box;
}

.bg-gradient-primary {
  background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%) !important;
}

.bg-gradient-light {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
}

.subject-icon {
  transition: all 0.3s ease;
}

.subject-card:hover .subject-icon {
  background: #0d6efd !important;
  transform: scale(1.1);
}

.subject-card:hover .subject-icon i {
  color: white !important;
}

.object-fit-cover {
  object-fit: cover;
}

/* Responsive */
@media (max-width: 768px) {
  .hero-section {
    border-radius: 0 0 1rem 1rem;
    padding: 2rem 0;
  }
  
  .display-4 {
    font-size: 2rem;
  }
}
</style>
{% endblock %}