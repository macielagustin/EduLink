<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test Geocodificación Inversa</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    #map { height: 400px; border: 1px solid #ccc; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h2>Prueba con Nominatim</h2>

  <div id="map"></div>

  <form>
    <label>Latitud:</label>
    <input type="text" id="lat" readonly><br><br>

    <label>Longitud:</label>
    <input type="text" id="lon" readonly><br><br>

    <label>Provincia:</label>
    <input type="text" id="provincia"><br><br>

    <label>Municipio:</label>
    <input type="text" id="municipio"><br><br>

    <label>Calle:</label>
    <input type="text" id="calle"><br><br>
  </form>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      let map = L.map("map").setView([-28.4696, -65.7795], 13); // Catamarca por defecto

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors"
      }).addTo(map);

      let marker;

      map.on("click", async function(e) {
        if (marker) map.removeLayer(marker);
        marker = L.marker(e.latlng).addTo(map);

        document.getElementById("lat").value = e.latlng.lat;
        document.getElementById("lon").value = e.latlng.lng;

        try {
          const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${e.latlng.lat}&lon=${e.latlng.lng}&zoom=18&addressdetails=1`;
          const resp = await fetch(url, { headers: { "Accept-Language": "es" } });
          const data = await resp.json();
          console.log("Datos Nominatim:", data);

          if (data.address) {
            document.getElementById("provincia").value = data.address.state || "";
            document.getElementById("municipio").value = data.address.city || data.address.town || data.address.village || "";
            document.getElementById("calle").value = data.address.road || "";
          }
        } catch (err) {
          console.error("Error en geocodificación inversa:", err);
        }
      });
    });
  </script>
</body>
</html>
